!function(){$(document).on("blur","form .form-group input",function(){s($(this))}),$(".get-captcha").click(function(){var s=$(this),t=s.attr("src");s.attr("src",t+parseInt(10*Math.random()))}),$(".get-phone-code").click(function(){var s=$(this),t=s.closest("form").find("input[name='phone']").val(),a=s.closest("form").find("input[name='captcha']").val();$.post(owAPI.getNewPhoneSMS,{phone:t,captcha:a},function(t){if(t.error)""!==t.redirect&&(layer.msg(t.msg),$(".get-captcha").trigger("click"));else{var a=t.data.smsInterval;s.addClass("invalid").text("重新发送("+a+")");var e=setInterval(function(){a--,0===a?(s.removeClass("invalid").text("获取验证码"),clearInterval(e)):s.addClass("invalid").text("重新发送("+a+")")},1e3)}})}),$(".j-reg-phone").click(function(){var t=$(this),a=1;t.closest("form").find("input").each(function(){"_token"!==$(this).attr("name")&&(s($(this)),$(this).hasClass("has-error")&&(a=0))}),a&&$(this).closest("form").submit()}),$(".j-reg-email").click(function(){var t=$(this),a=t.closest("form"),e=a.find("input[name='email']").val(),i=a.find("input[name='username']").val(),r=a.find("input[name='password']").val(),n=t.closest("form").find("input[name='password_confirmation']").val(),o=t.closest("form").find("input[name='captcha']").val(),l=1;t.closest("form").find("input").each(function(){s($(this)),$(this).hasClass("has-error")&&(l=0)}),l&&$.post(owAPI.regEmail,{email:e,username:i,password:r,password_confirmation:n,captcha:o},function(s){s.error||($(".new-email").text(e),$(".go-email").attr("href",s.data.url),a.addClass("hide").siblings(".reg-email-msg").removeClass("hide"))})});var s=function(s){var t=s,a=t.val(),e=t.attr("datatype"),i=t.attr("errormsg"),r=t.attr("nullmsg");if(""===$.trim(a))t.siblings(".verify-tip").text(r),t.removeClass("has-success").addClass("has-error");else if(regs.dataType[e].test($.trim(a))){if(t.addClass("has-success").removeClass("has-error"),t.siblings(".verify-tip").text(""),"password_confirmation"===t.attr("name")){var n=t.closest("form").find("input[name='password']").val(),o=t.val();n===o?t.siblings(".verify-tip").text(""):t.siblings(".verify-tip").text(t.attr("psdWrong"))}}else t.siblings(".verify-tip").text(i),t.removeClass("has-success").addClass("has-error")}}();