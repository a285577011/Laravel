!function(){$(document).on("blur",".form-group input",function(){s($(this))});var s=function(s){var i=s,e=i.val(),t=i.attr("datatype"),a=i.attr("errormsg"),n=i.attr("nullmsg");if(""===$.trim(e))i.siblings(".verify-tip").text(n),i.removeClass("has-success").addClass("has-error");else if(regs.dataType[t].test($.trim(e))){if(i.addClass("has-success").removeClass("has-error"),i.siblings(".verify-tip").text(""),"password_confirmation"===i.attr("name")){var r=i.closest("form").find("input[name='password']").val(),o=i.val();r===o?i.siblings(".verify-tip").text(""):i.siblings(".verify-tip").text(i.attr("psdWrong"))}}else i.siblings(".verify-tip").text(a),i.removeClass("has-success").addClass("has-error")};$(".change-avatar").click(function(){$(this).siblings(".pa-file").trigger("click")}),$(".pa-file").change(function(){var s=$(".pa-img"),i=navigator.userAgent,e=$(this)[0].value;if(i.indexOf("MSIE")>=0){if(!/\.(jpg|jpeg|png|gif|JPG|PNG|JPEG)$/.test(e))return e="",s.attr("src","/img/default.png"),!1;s.attr("src",e)}else{if(!/\.(jpg|jpeg|png|gif|JPG|PNG|JPEG)$/.test(e))return e="",s.attr("src","/img/default.png"),!1;var t=$(this)[0].files[0],a=URL.createObjectURL(t);s.attr("src",a)}}),$(".pi-modify-ok").click(function(){$(this).closest("form").submit()}),$(".j-change-psd").click(function(){var i=$(this),e=1,t=$("input[name='oldPsd']").val(),a=$("input[name='password']").val(),n=$("input[name='password_confirmation']").val();i.closest("form").find("input").each(function(){s($(this)),$(this).hasClass("has-error")&&(e=0)}),e&&$.post(owAPI.changePsd,{old_password:t,password:a,password_confirmation:n},function(s){if(s.error)layer.msg(s.msg);else{var e=s.data.status,t=s.data.text;e?(i.closest(".m-modify").siblings(".set-status").find(".c-success").removeClass("hide").siblings("i").addClass("hide"),$(".psd-level").text(t)):i.closest(".m-modify").siblings(".set-status").find(".c-fail").removeClass("hide").siblings("i").addClass("hide"),i.closest(".m-modify").addClass("hide").siblings(".modify-btn").removeClass("hide")}})}),$(".j-change-email").click(function(){var i=$(this),e=1,t=$("input[name='newEmail']").val(),a=$("input[name='emailPsd']").val();i.closest("form").find("input").each(function(){s($(this)),$(this).hasClass("has-error")&&(e=0)}),e&&$.post(owAPI.changeEmail,{email:t,old_password:a},function(s){if(s.error)i.closest(".m-modify").siblings(".set-status").find(".c-fail").removeClass("hide").siblings("i").addClass("hide"),layer.msg(s.msg);else{var e=s.data.status,t=s.data.email,a=s.data.text;e?i.closest(".m-modify").siblings(".set-status").find(".c-success").removeClass("hide").siblings("i").addClass("hide"):i.closest(".m-modify").siblings(".set-status").find(".c-fail").removeClass("hide").siblings("i").addClass("hide"),$(".cur-email").text(t),$(".email-text").text(a),i.closest(".m-modify").addClass("hide").siblings(".modify-btn").removeClass("hide")}})}),$(".phone-verify1").click(function(){var s=$(this),i=s.attr("data-val");return s.hasClass("invalid")?!1:void $.post(owAPI.getOldPhoneSMS,{user:i},function(i){var e=i.data.smsInterval;getSMS(s,e)})}),$(".phone-verify2").click(function(){var s=$(this),i=$("input[name='newPhone']").val(),e=$("input[name='newPhoneCaptcha']").val();$.post(owAPI.getNewPhoneSMS,{phone:i,captcha:e},function(i){if(i.error)i.redirect&&(layer.msg(i.msg),$(".phone-step2-captcha").trigger("click").siblings("input").val("").focus());else{var e=i.data.smsInterval;getSMS(s,e)}})}),$(".j-change-phone1").click(function(){var i=$(this),e=1,t=$("input[name='psc1']").val();i.closest("form").find("input").each(function(){s($(this)),$(this).hasClass("has-error")&&(e=0)}),e&&$.post(owAPI.changeOldPhone,{smsCaptcha:t},function(s){s.error?i.closest(".m-modify").siblings(".set-status").find(".c-fail").removeClass("hide").siblings("i").addClass("hide"):i.closest(".m-modify").addClass("hide").siblings(".cp-step2").removeClass("hide")})}),$(".phone-step2-captcha").click(function(){var s=$(this),i=s.attr("src");s.attr("src",i+parseInt(10*Math.random()))}),$(".j-change-phone2").click(function(){var i=$(this),e=1,t=$("input[name='newPhone']").val(),a=$("input[name='psc2']").val();i.closest("form").find("input").each(function(){s($(this)),$(this).hasClass("has-error")&&(e=0)}),e&&$.post(owAPI.changeNewPhone,{phone:t,smsCaptcha:a},function(s){if(s.error)layer.msg(s.msg),s.redirect&&setTimeout(function(){window.location.href=s.redirect},2e3);else{var e=s.data.status,t=s.data.phone;e?i.closest(".m-modify").siblings(".set-status").find(".c-success").removeClass("hide").siblings("i").addClass("hide"):i.closest(".m-modify").siblings(".set-status").find(".c-fail").removeClass("hide").siblings("i").addClass("hide"),$(".cur-phone").text(t),i.closest(".m-modify").addClass("hide").siblings(".modify-btn").attr("data-val",1).removeClass("hide")}})})}();